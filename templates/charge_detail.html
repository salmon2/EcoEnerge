<!doctype html>
<html lang="en">
</html>

<head>
    <!-- Webpage Title -->
    <title>Detail | EcoEnergy</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <meta property="og:title" content="EcoEnergy"/>
    <meta property="og:description" content="EcoEnergy충전소에서 서울의 전기 자동차 위치를 찾으세요!"/>
    <meta property="og:image" content="{{ url_for('static', filename='ogimg.png') }}"/>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <!-- Font Awesome CSS -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">
    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <script src="https://kit.fontawesome.com/fc2bb77ae0.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <style>
        body {
            background-color: rgb(000, 153, 153);
            min-height: 100vh;
		    padding-top: 3.25rem;
        }

        .section {
            padding: 1rem 1.5rem;
            max-width: 750px;
            margin: auto;
        }

        .is-sparta {
            color: #e8344e !important;
        }

        .button.is-sparta {
            background-color: #e8344e;
            border-color: transparent;
            color: #fff !important;
        }

        .button.is-sparta.is-outlined {
            background-color: transparent;
            border-color: #e8344e;
            color: #e8344e !important;
        }

        .modal-content {
            width: 600px;
            max-width: 80%;
        }

        input::-webkit-calendar-picker-indicator {
            display: none;
        }

        .card-img-top{
            object-fit:cover;
            width:80%;
            height:80%;

            margin-left: 65px;
            margin-top: 50px;
        }
        .card{
            background-color: rgb(255, 204, 204);
        }
        .media{
            margin-bottom: 30px;
        }
        .updateBtn{

            height: 20px;
            width: 20px;
        }



    </style>

    <script>
        function posting(){
            console.log("posting")
            let contents_give = $("#textarea-post").val()
            $.ajax({
                type:"POST",
                url:"/review",
                data:{
                    contents:contents_give,
                    chargeId:`{{charge._id}}`,
                },
                success: function(response){
                    if (response['result'] == 'success') {
                        $("#modal-post").removeClass("is-active")
                        alert(response['msg'])
                        window.location.reload()
                    }
                }
            })
        }

        function delete_one(reviewID){
            console.log("DELETE")
            $.ajax({
                type:'POST',
                url:"/review/delete",
                data:{
                    _id : reviewID
                },
                success: function (response) {
                    if (response['result'] == 'uthorization fail') {
                        alert(response['msg'])
                    }
                    else{
                        alert(response['msg'])
                        window.location.reload()
                    }

                }
            })

        }
        
        let reviewId;
        function update(){
            console.log("update")
            console.log(reviewId)
            let contents_give = $("#textarea-update").val()
            $.ajax({
                type: "POST",
                url: "/review/update",
                data: {
                    _id : reviewId,
                    contents:contents_give,
                    chargeId:`{{charge._id}}`,
                    rate : 0,
                    like : 0
                },
                success: function (response) {
                    if (response['result'] == 'uthorization fail') {
                        alert(response['msg'])
                    }
                    else{
                        $("#modal-post2").removeClass("is-active")
                        alert(response['msg'])
                        window.location.reload()
                    }
                }
            });
        }

       
        function setReviewId(id){
            reviewId = id;
            console.log(reviewId);
        }

    </script>
</head>

<body>
<!--navigation tab-->
<nav class="navbar is-fixed-top is-white" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="/" style="margin-right: 15px;">
            <i class="fa fa-car" aria-hidden="true"></i>
            <strong class="is-sparta"
                    style="font-family: 'Do Hyeon', sans-serif; font-size: larger;">EcoEnergy</strong>
        </a>
    </div>
</nav>

    <!-- charge Detail -->
    <section class="section">
        <div class="card">

            {% if charge.img == none %}
                <img class="card-img-top" src="../static/default_charge{{ range(0, 9) | random }}.jpg">
            {% else %}
                <img class="card-img-top" src="{{charge.img}}">
            {% endif %}

            <div class="card-body">
                <h5 class="card-title">{{charge.chargeName}}</h5>
                <p class="card-text">{{charge.address}}</p>
            </div>
            </div>
        </div>
    </section>

    <!-- review List -->
    <section class="section">
            <div id="post-box" class="container">
                {% for review  in reviewList %}
                    <div class="box">
                        
                        <article class="media">
                            <figure class="media-left" style="align-self: center">
                                {{review.writer}}
                            </figure>
                            <div class="media-content">
                                <div class="content">
                                    <p>
                                        {{review.contents}}
                                    </p>
                                </div>     
                            </div>
                        </article>
                    
                        <button id = "{{review._id}}" type="button" class="btn btn-primary" onclick= 'delete_one("{{review._id}}")'>
                            <i class="fa fa-trash" aria-hidden="true"></i>
                        </button>

                        <button id = "{{review._id}}" type="button" class="btn btn-primary"  onclick=' setReviewId("{{review._id}}"); $("#modal-update").addClass("is-active")'>
                            <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                        </button>
                    </div>
                {% endfor %}
            </div>
            


            <!-- 입력 칸 -->
            <section class="section">

                <article class="media">
                    <div class="media-content">
                        <div class="field">
                            <p class="control">
                                  <input id="input-post" class="input is-rounded" placeholder="리뷰를 작성해 주세요" onclick= '$("#modal-post").addClass("is-active"); '>                
                            </p>
                        </div>
                    </div>
                </article>

                <!-- modal section -->
                <div class="modal" id="modal-post">
                    <div class="modal-background" onclick='$("#modal-post").removeClass("is-active")'></div>
                    <div class="modal-content">
                        <div class="box">
                            <article class="media">
                                <div class="media-content">
                                    <div class="field">
                                        <p class="control">
                                            <textarea id="textarea-post" class="textarea"
                                                      placeholder="이 충전소는 어떤가요?"></textarea>
                                        </p>
                                    </div>
                                    <nav class="level is-mobile">
                                        <div class="level-left">
    
                                        </div>
                                        <div class="level-right">
                                            <div class="level-item">
                                                <a class="button is-sparta"  onclick = "posting()">포스팅하기</a>
                                            </div>
                                            <div class="level-item">
                                                <a class="button is-sparta is-outlined"
                                                   onclick='$("#modal-post").removeClass("is-active")'>취소</a>
                                            </div>
                                        </div>
                                    </nav>
                                </div>
                            </article>
                        </div>
                    </div>
                    <button class="modal-close is-large"  aria-label="close" onclick='$("#modal-post").removeClass("is-active")'></button>
                </div>
                <div class="modal" id="modal-update">
                    <div class="modal-background" onclick='$("#modal-update").removeClass("is-active")'></div>
                    <div class="modal-content">
                        <div class="box">
                            <article class="media">
                                <div class="media-content">
                                    <div class="field">
                                        <p class="control">
                                            <textarea id="textarea-update" class="textarea"
                                                      placeholder="리뷰를 수정해 주세요"></textarea>
                                        </p>
                                    </div>
                                    <nav class="level is-mobile">
                                        <div class="level-left">
    
                                        </div>
                                        <div class="level-right">
                                            <div class="level-item">
                                                <a class="button is-sparta"  onclick = "update();">수정하기</a>
                                            </div>
                                            <div class="level-item">
                                                <a class="button is-sparta is-outlined"
                                                   onclick='$("#modal-update").removeClass("is-active")'>취소</a>
                                            </div>
                                        </div>
                                    </nav>
                                </div>
                            </article>
                        </div>
                    </div>
                    <button class="modal-close is-large"  aria-label="close" onclick='$("#modal-update").removeClass("is-active")'></button>
                </div>
            </section>


        </section>



        


</body>

</html>